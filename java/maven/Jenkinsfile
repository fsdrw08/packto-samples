pipeline {
    agent {
        label "docker-agent"
    }
    stages {
        stage("test") {
            steps {
                script {
                    sh '''
                        whoami
                    '''
                    sh '''
                        ls -al /var/run/docker.sock
                    '''
                    sh '''
                        ls -al
                    '''
                    sh '''
                        docker run \
                            --rm \
                            --cap-add=SYS_ADMIN \
                            --tmpfs /tmp:rw \
                            --volume /var/run/docker.sock:/var/run/docker.sock:rw \
                            --volume ./java/maven/:/workspace:rw \
                            --workdir /workspace \
                            --env HOME="/workspace" \
                            docker.io/buildpacksio/pack:latest build \
                                --trust-builder \
                                paketo-demo-app \
                                --path . \
                                --builder docker.io/paketobuildpacks/builder:base \
                                --buildpack docker.io/paketobuildpacks/java-azure:10

                    '''
                }
            }
        }
    }
}